<!DOCTYPE html>
<html>
<head>
    <title>Private Chat</title>
</head>
<body>

<h2>Private Chat</h2>

<input type="text" id="msg" placeholder="Nhập tin nhắn">
<button onclick="sendMessage()">Gửi</button>

<ul id="chat-log"></ul>

<script>
const roomName = "{{ room_name|escapejs }}";

// tự động chọn ws hoặc wss
const protocol = window.location.protocol === "https:" ? "wss" : "ws";

const chatSocket = new WebSocket(
    protocol + "://" + window.location.host + "/ws/chat/" + roomName + "/"
);

chatSocket.onopen = function() {
    console.log("WebSocket connected");
};

chatSocket.onerror = function(e) {
    console.log("WebSocket error", e);
};

chatSocket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    const li = document.createElement("li");
    li.textContent = data.user + ": " + data.message;
    document.getElementById("chat-log").appendChild(li);
};

function sendMessage() {
    const input = document.getElementById("msg");
    const message = input.value;

    if (!message.trim()) return;

    chatSocket.send(JSON.stringify({
        message: message
    }));

    input.value = "";
}
</script>

</body>
</html>